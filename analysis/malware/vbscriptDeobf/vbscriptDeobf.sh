#!/bin/bash

if [ $# -lt 3 ]; then
	echo "Usage: $0 [vbscript file] [desired python filename] [desired executable filename]"
	echo "	example: $0 shell.asp string.py out.bin"
	exit
fi

ifile=$1
ofile=$2
binfile=$3

rm $binfile 2>/dev/null
echo 'str=""' > $ofile

grep Chr $ifile |
	while read p; do
		T1=$(echo $p | sed -e 's/Chr/chr/g' | sed -e 's/&//g' | sed -e 's/)/)+/g');
		VAR=$(echo $T1 | cut -d"=" -f 1);
		TMP="str+=$(echo -n $T1 | sed -e "s/$VAR//g" | cut -d= -f 2)";
		STR=${TMP::-2};
		python3 -c "tmp='$STR'
if tmp.endswith(')'): print(tmp)
else:print(tmp,')')" >> $ofile;done

echo "print(str)" >> $ofile
python3 $ofile >> $binfile
