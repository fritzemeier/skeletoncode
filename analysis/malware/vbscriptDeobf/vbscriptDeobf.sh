#!/bin/bash
ifile=$1
ofile=$2

if [ $# -lt 2 ]; then
        echo "Usage: $0 [vbscript file] [desired output filename]"
        echo "  example: $0 shell.asp out.bin"
        exit
fi

if [ ! -f "$ifile" ]; then
	echo "Cannot find vbscript file: $ifile"
	exit
fi

if [ -f "$ofile" ]; then
	read -p "$ofile exists. Delete? (y/n) " del
	if [ "$del" = "y" ]; then
		rm $ofile 2>/dev/null
	else
		echo "File must be moved or deleted to continue deobfuscation."
		exit
	fi
fi

CMD="str='';"$(grep Chr $ifile | while read p; do
		T1=$(echo $p | sed -e 's/Chr/chr/g' | sed -e 's/&//g' | sed -e 's/)/)+/g');
		VAR=$(echo $T1 | cut -d"=" -f 1);
		TMP="$(echo -n $T1 | sed -e "s/$VAR//g" | cut -d= -f 2)";
		STR=${TMP::-2};
		python3 -c "tmp='str+=$STR'
if tmp.endswith(')'): print(tmp,end=';')
else:print(tmp,end=');')";done)"print(str)"

python3 -c "$CMD" >> $ofile
